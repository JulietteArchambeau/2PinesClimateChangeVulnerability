---
title: "Exploratory analyses"
author: "Juliette Archambeau"
date: "`r format(Sys.time(), '%d %B, %Y')`"
format: 
  html:
    toc: true
    toc-depth: 4
    code-fold: true
    page-layout: full
embed-resources: true
bibliography: references.bib
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
body {
   font-size: 15px;
}
code.r{
  font-size: 11px;
}
pre {
  font-size: 11px
}

table {
  font-size: 11px
}
</style>

```{r setup, include=F}
knitr::opts_chunk$set(cache=F)
options(width = 300)
library(knitr)      # CRAN v1.26
library(kableExtra) # CRAN v1.1.0
library(tidyverse)
library(here)
library(magrittr)
library(corrplot)
library(readxl)
library(cowplot)

# my own function for building tables in reports
source(here("scripts/functions/kable_mydf.R"))
```

```{r}
data <- read_excel(here("data/Field.xlsx"), na = "NA")
```


```{r TraitNames}
trait_names <- data %>% 
  dplyr::select(contains("HA"),contains("BD"),contains("BT")) %>% 
  colnames()

trait_names <- lapply(trait_names, function(x){
  
  if(grepl("HA",x)==TRUE){
    year <- str_sub(x,3,-1)
    trait_name <- paste0("Height in 20",year)
    list(code=x,name=trait_name)
  
    } else if(grepl("BD",x)==TRUE){
      year <- str_sub(x,3,-1)
      trait_name <- paste0("Duration of burburst in 20",year)
      list(code=x,name=trait_name)
      
    } else if(grepl("BT",x)==TRUE){
      year <- str_sub(x,3,-3)
      stage <- str_sub(x,6,-1)
      trait_name <- paste0("Time taken to reach stage ",stage," in 20", year)
      list(code=x,name= trait_name)
    }
}) %>% setNames(trait_names)

trait_names %>% 
  bind_rows() %>% 
  setNames(c("Variable code","Variable name")) %>% 
  kable_mydf()
```

```{r Histogram, fig.width=14,fig.height=14}
data %>% 
  dplyr::select(names(trait_names)) %>% 
  pivot_longer(everything(),names_to="variable",values_drop_na = TRUE) %>% 
  ggplot(aes(x=value)) +  
  geom_histogram(aes(y=after_stat(density)), colour="blue",fill="white",bins = 100) +
  geom_density(alpha=.2,fill="pink") +
  xlab("") +
  facet_wrap(~variable,scales="free") + 
  theme_bw() 
```

